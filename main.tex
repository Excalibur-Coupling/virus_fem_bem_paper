% Modified for use with JCC - Madhusudan Singh Copyright (C) (2012). All rights reserved.
\documentclass[12pt]{article}

\setlength{\oddsidemargin}{0in}  %left margin position, reference is one inch
\setlength{\textwidth}{6.5in}    %width of text=8.5-1in-1in for margin
\setlength{\topmargin}{-0.5in}    %reference is at 1.5in, -.5in gives a start of about 1in from top
\setlength{\textheight}{9in}     %length of text=11in-1in-1in (top and bot. marg.) 
\newenvironment{wileykeywords}{\textsf{Keywords:}\hspace{\stretch{1}}}{\hspace{\stretch{1}}\rule{1ex}{1ex}}

\usepackage{amsmath,amssymb}
\usepackage{graphicx}% Include figure files
%\usepackage{caption}
\usepackage{color}% Include colors for document elements
\usepackage{dcolumn}% Align table columns on decimal point
\usepackage{bm}% bold math
\usepackage[numbers,super,comma,sort&compress]{natbib}
\usepackage{multirow}
%\usepackage[nolists, nomarkers, figuresfirst]{endfloat}


\usepackage{hyperref}

\definecolor{background-color}{gray}{0.98}

\title{Coupling finite and boundary element methods to solve the Poisson--Boltzmann equation for electrostatics in molecular solvation}
\author{Micha\l{} Bosy\thanks{School of Computer Science and Mathematics, Kingston University London, Penrhyn Road, Kingston upon Thames, KT1 2EE, UK}, 
    Matthew W. Scroggs\thanks{Department of Mathematics, University College London, 25 Gordon Street, WC1H 0AY London, UK}, 
    Timo Betcke\footnotemark[2],~\\%\thanks{Department of Mathematics, University College London, 25 Gordon Street, WC1H 0AY London, UK}, 
    Erik Burman\footnotemark[2],~%\thanks{Department of Mathematics, University College London, 25 Gordon Street, WC1H 0AY London, UK}, 
    Christopher D. Cooper\thanks{Department of Mechanical Engineering and Centro Cient\'ifico Tecnol\'ogico de Valpara\'iso, Universidad T\'ecnica Federico Santa Mar\'ia, Valpara\'iso 2390123, Chile}}

\begin{document}

\maketitle


\begin{abstract}
The Poisson--Boltzmann equation is widely used to model electrostatics in molecular systems. Available software packages solve it using finite difference, finite element, and boundary element methods, where the latter is attractive due to the accurate representation of the molecular surface and partial charges, and exact enforcement of the boundary conditions at infinity. However, the boundary element method is limited to linear equations and piecewise constant variations of the material properties. In this work, we present a scheme that couples finite and boundary elements for the Poisson--Boltzmann equation, where the finite element method is applied in a confined {\it solute} region, and the boundary element method in the external {\it solvent} region. As a proof-of-concept exercise, we use the simplest methods available: Johnson--N\'ed\'elec coupling with mass matrix and diagonal preconditioning, implemented using the Bempp-cl and FEniCSx libraries via their Python interfaces. We showcase our implementation by computing the polar component of the solvation free energy of a set of molecules using a constant and a Gaussian-varying permittivity. We validate our implementation against the finite difference code APBS (to 0.5\%), and show scaling from protein G B1 (955 atoms) up to immunoglobulin G (20\,148 atoms). For small problems, the coupled method was efficient, outperforming a purely boundary integral approach. For Gaussian-varying permittivities, which are beyond the applicability of boundary elements alone, we were able to run medium to large sized problems on a single workstation. Development of better preconditioning techniques and the use of distributed memory parallelism for larger systems remains an area for future work. We hope this work will serve as inspiration for future developments that consider space-varying field parameters, and mixed linear-nonlinear schemes for molecular electrostatics with implicit solvent models. 
\end{abstract}

\begin{wileykeywords}
Finite element method, Boundary element method, Poisson--Boltzmann, Implicit solvent model, Electrostatics.
\end{wileykeywords}

\clearpage

%*****************Graphical Table of Contents******************** THIS IS MANDATORY *******************


\begin{figure}[h]
\centering
\colorbox{background-color}{
\fbox{
\begin{minipage}{1.0\textwidth}
\includegraphics[width=50mm,height=50mm]{graphical_abstract_fem-bem.png} %Pick only one of the two styles by uncommenting the corresponding \includegraphics
%\includegraphics[width=110mm,height=20mm]{cc.eps}
\\
    The boundary element method is a popular numerical algorithm to solve the Poisson--Boltzmann equation for molecular electrostatics. However, this technique is limited to linear equations and piecewise constant variations of the field parameters. Here, we overcome such limitations by coupling it with a finite element method, implemented using the Bempp-cl and FEniCSx libraries via their Python interfaces. This results in an efficient, accurate, flexible, and easy-to-use computational tool for model development. 
\end{minipage}
}}
\end{figure}

% makes references listed with 1., 2., etc.  
0  \makeatletter
  \renewcommand\@biblabel[1]{#1.}
  \makeatother

\bibliographystyle{apsrev}

\renewcommand{\baselinestretch}{1.5}
\normalsize


\clearpage


\section*{\sffamily \Large INTRODUCTION} % Not needed for rapid communications

\input{intro}

% The opening sentence of the manuscript should summarize the reasons for the undertaking of the work and the main conclusions that can be drawn.

%((Place Introduction here))

%((Main text paragraphs should be 12 point font, double-spaced. Reviews are comprehensive survey of recent progress in a topic of broad interest in quantum chemistry, providing the readership with an appreciation of the importance of the work, a summary of recent developments, and a guide to the relevant literature. Perspective are short discussions of an important emerging topics in quantum chemistry, usually focused on no more than a few recently published papers, and including the authors' vision for the future of the topics, identifying important problems that should be addressed next. Perspective should be limited to 3000 words, 4 display items (figures and/or tables), and 30 references.))

%((Full Papers are comprehensive reports of important recent advances in the development of basic theory, quantum mechanical computational methodologies and their relevant applications that provide significant insight to problems of broad interest in chemistry, physics, biology, and materials science. The opening sentence of the manuscript should summarize the reasons for the undertaking of the work and the main conclusions that can be drawn. The main text should be contain sections with brief subheadings, a summary of the major conclusions of the paper, and a Method section containing sufficient detail to reproduce the work. Main text paragraphs should be 12 point font, double-spaced.))

%((Rapid communications should be limited to 1500 words, 3 display items (figure and/or tables), 20 references. Main text paragraphs should be 12 point font, double-spaced. There are NO headings in the main text.))

\section*{\sffamily \Large METHODOLOGY}
\input{methods}

%((Place Computational Methods here. Not needed for review articles))

%((Computational results should be prepared following the IUPAC guidelines (See Journal of Computational Chemistry, 20: 1587-1590 and 20:1591-1592). In particular, it is required that the level of theory employed is appropriate to the problem at hand, and that the sufficient details about methodology are provided to allow the work to be reproduced.)

%((In full papers, this section appears immediately after the introduction. In Rapid Communications, this section appears just before the Acknowledgments.))

\section*{\sffamily \Large RESULTS AND DISCUSSION}
\input{results}
%((Place Results here. Not needed for review articles.))

%\section*{\sffamily \Large First-order heading}
 
%((Equations should be inserted using standard LaTeX equation and eqnarray environments, not as graphics, and should be set in the main text))
%Equation											(1)
%((References should be superscripted and appear after punctuation.1,2 Please define all acronyms at their first usage except IR, UV, NMR, and DNA or similar commonly understood terms.)) 


%\subsection*{\sffamily \large Second-order heading}

%\subsubsection*{\sffamily \normalsize Third-order heading}

%{\sffamily \small Fourth-order heading}\\

%\section*{\sffamily \Large DISCUSSION}

%((Place Discussion here. Not needed for review articles.))


\section*{\sffamily \Large CONCLUSIONS}
\input{conclusion}
%((Place Conclusions here.))



\subsection*{\sffamily \large ACKNOWLEDGMENTS}
MB acknowledges the support from Kingston University through First Kingston University Grant. \\
CDC acknowledges the support from CCTVal through ANID PIA/APOYO AFB220004.\\
MS needs to look up the grant he has to put here. \\
We would like to thank J{\o}rgen Dokken for his help with various implementation details related to FEniCSx.
%((Place Acknowledgments here))

\subsection*{\sffamily \large DATA AVAILABILITY STATEMENT}
All codes to reproduce the results of this manuscript can be found in the Github repository \url{https://github.com/MichalBosy/FEM_BEM_coupling/}, alongside links to Docker images
that include the codes alongside installations of appropriate versions of Bempp-cl and FEniCSx.

%((Additional Supporting Information may be found in the online version of this article.))

\clearpage

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% BIBLIOGRAPHY

\bibliography{main}   % Produces the bibliography via BibTeX.

%\begin{thebibliography}{99}
%
%
%\bibitem{Coulson}
%Coulson, C. A., Rev. Mod. Phys., \textbf{1960}, 32,170-177.
%\bibitem{Malrieu}
%Malrieu, J.-P., J. Mol. Struct., \textbf{1998}, 424, 1-2,83-91.
%\bibitem{Shaik}
%Shaik, S., New. J. Chem., \textbf{2007}, 31,2015-2028.
%\bibitem{Hoffmann}
%Hoffman, R., Schleyer, P. v. R., Schaefer III, H. F., \textbf{2008}, 47, 7164-7167.
%\bibitem{Perdew}
%Perdew, J. P., Ruzsinszky, A., Constantin, L., Sun, J., Csonka, G., J. Chem. Theory Comput., \textbf{2009}, 5, 902-908.
%\bibitem{Koros}
%Koros, W. J.; Chern, R. T. In Handbook of Separation Process Technology; Rousseau, E. D.; Russell, B., Eds.; Wiley: New York, \textbf{1987}; Vol. 2, Chapter 20, pp 34-45.
%\end{thebibliography}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%\clearpage
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% FIGURE CAPTIONS
%
%%%%%% FIGURE ---- cc.eps
%\begin{figure}
%\caption{\label{cc} Place Figure 1 caption here. In the case of reproduced figures in review articles, you must obtain the publisher's permission and state a suitable notice here along with a citation.}
%\end{figure}
%
%\begin{figure}
%\caption{\label{fig2} Place Figure 2 caption here. Figures should be uploaded as individual files, preferably .tif or .eps files, at high enough resolution (600 to 1200 dpi) to ensure clarity. Please see the authorâ€™s guide for more details and specifications. For high quality illustrations, we highly recommend the use of the TikZ package.}
%\end{figure}
%
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% FIGURE FILES
%
%\clearpage
%
%%\vspace*{0.1in}   %%% FIGURE 1
%%\begin{center}
%%\includegraphics[width=0.2\columnwidth,keepaspectratio=true]{cc.eps}
%%\end{center}
%\vspace{0.25in}
%\hspace*{3in}
%{\Large
%\begin{minipage}[t]{3in}
%\baselineskip = .5\baselineskip
%Figure 1 \\
%Author A, Author B, Author C, Author D \\
%J.\ Comput.\ Chem.
%\end{minipage}
%}
%
%\clearpage
%
%\begin{table}
%\begin{tabular}{|c|c|c|c|}\hline
%\textbf{Quantity} & \textbf{Calculated} & \textbf{Observed} & \textbf{Error} \\ \hline
%  Density & 5.3 & 6.3 & Within limits \\ \hline
%  Optical magnification & 8.3 & 90.9 & Utterly unacceptable\! \\ \hline
%\end{tabular}
%\caption{\label{tbl1} Place table caption here.}
%\end{table}

\end{document}

