This section presents verification and performance results of the standard and hybrid FEM-BEM coupling schemes, for molecules modeled as cavities with constant and varying permittivity.
With a constant permittivity inside the molecule, we tested convergence against an analytical expression of the solvation energy of a sphere \cite{Kirkwood1934}, and then compared a more realistic geometry (arginine) with a purely BEM implementation.
We also considered a Gaussian-varying permittivity\cite{grant2001smooth,li2013dielectric} inside the molecular cavity of arginine, and used APBS \cite{BakerETal2001} to verify our results.
The final tests show the scaling of the standard and hybrid FEM-BEM coupling, as the molecule size grows. 

All runs were done on XX computer with YY specifications. 

\section*{\sffamily \Large Results with constant permitivitty}

In implicit-solvent models, the molecule is usually considered as a region with constant permittivity, in this case, with $\epsilon_1=4$.
In the solvent region, we used the permittivity of water ($\epsilon_2$=80) and an inverse of the Debye length of $\kappa=0.125$ \AA$^{-1}$.
As in these cases there is an analytical solution for $\phi_c$ in Eq. \eqref{eq:phic}, we compute $\phi_r$ with Eq. \eqref{eq:phi_reac} in both BEM-BEM and FEM-BEM coupling approaches. Then, for FEM-BEM, the integral over $\Gamma$ in Eq. \eqref{eq:phi_reac} corresponds to the trace of the solution vector.

\subsection*{\sffamily \large Convergence of a spherical cavity}

The Kirkwood sphere \cite{Kirkwood1934} is a standard benchmark test for the Poisson-Boltzmann equation in molecular electrostatics. 
In this case, we considered a spherical cavity of radius $R=2$ \AA, with three charges ($q_1$=1, $q_2$=1, and $q_3$=0.75) placed at $\mathbf{x}_1=(1,0,0)$, $\mathbf{x}_2=(0.7,0.7,0)$, and $\mathbf{x}_3=(-0.5,-0.5,0)$.
Figure \ref{fig:error_sphere} shows the error convergence of the standard and hybrid FEM-BEM approaches, and a reference BEM implementation, to the analytical solution ($\Delta G_{solv}= -164.3375$ kcal/mol). 
In these runs, the FEM mesh was generated using Bempp (check?) from a surface discretization with W, X, Y, and Z vertices per \AA$^2$ on the SES, which was also used for the BEM runs. 
For the hybrid FEM-BEM coupling approach, we used $\tau$=5.
The error in Figure \ref{fig:error_sphere} decays linearly with the surface area, which agrees with the expected convergence for P1 elements, indicating a correct implementation of the numerical scheme. 
%We can see that the purely BEM implementation outperforms (or not?) FEM-BEM coupling in terms of accuracy for equivalent meshes, and also that the hybrid approach does not (or does?) influence accuracy. 

\begin{figure}
  \centering
  \includegraphics[width=0.6\linewidth]{Sphere_const_coeff_error.png}
%   \includegraphics[width=0.45\linewidth]{Sphere_const_coeff_iter.png}
%   \includegraphics[width=0.45\linewidth]{Sphere_const_coeff_time.png}
  \caption{Error for the Kirkwood sphere.}
  \label{fig:error_sphere}
\end{figure}

\subsection*{\sffamily \large Performance with arginine}

As a more realistic test, we assessed the performance of the standard and hybrid FEM-BEM coupling techniques against a purely BEM implementation for arginine [cite arg]. 
We generated surface meshes containing W, X, Y, and Z vertices per \AA$^2$ with Nanoshaper [Rocchia].
These meshes were inputs to our purely BEM solver, and to create the FEM mesh with pyGAMer [pygamer], which invoked \texttt{tetgen} with the string \texttt{abcd}.
For the hybrid FEM-BEM coupling approach, we used $\tau$=5.

The solvation energy computed with the three schemes is presented by Figure \ref{fig:arg_constant_energy}, which, as expected, converges to a similar answer as the mesh is refined.
Then, Figure \ref{fig:arg_constant_time} compares the time-to-solution, and shows that using only BEM outperforms both coupled FEM-BEM approaches.
Even though hybrid FEM-BEM is slower than standard FEM-BEM in Figure \ref{fig:arg_constant_time}, the iteration count in Figure \ref{fig:arg_constant_iter} shows that hybrid FEM-BEM needs less iterations (can we compare them?). 
This behavior is promising going towards larger problems, specially since the hybrid approach allows for more flexibility in the choice of preconditioner.

\begin{itemize}
\item Do we really need to compute the vacuum case numerically? We should be able to do it analytically, right?
\item Run BEM-BEM with the non regularized version.
\end{itemize}


\begin{figure}
\centering
   \includegraphics[width=0.45\linewidth]{Arginine_const_coeff_error.png}
%    \includegraphics[width=0.45\linewidth]{No_prec_Arginine_const_coeff_error.png}
\caption{Solvation energy for arginine with a constant permittivity (left: Preconditioned systems, right: No preconditioner).
%maybe we could also add a "error" wrt extrapolation, or a plot with energy for each mesh?
}
\label{fig:arg_constant_energy}
\end{figure}

\begin{figure}
\centering
%   \includegraphics[width=0.45\linewidth]{Arginine_const_coeff_iter.png}
  \includegraphics[width=0.45\linewidth]{Arginine_const_coeff_time.png}
%   \includegraphics[width=0.45\linewidth]{No_prec_Arginine_const_coeff_time.png}
\caption{Time-to-solution for arginine with a constant permittivity (left: Preconditioned systems, right: No preconditioner). NOTE: x axis differ between top and bottom. Also, should we include preconditioned vs non preconditioned? We could easily precondition BEM-BEM too.  %(1) fix title, (2) can we put them in a single plot, (3) 
%maybe we could also add a "error" wrt extrapolation, or a plot with energy for each mesh?
}
\label{fig:arg_constant_time}
\end{figure}


\begin{figure}
\centering
%   \includegraphics[width=0.45\linewidth]{Arginine_const_coeff_error.png}
  \includegraphics[width=0.45\linewidth]{Arginine_const_coeff_iter.png}
%   \includegraphics[width=0.45\linewidth]{No_prec_Arginine_const_coeff_iter.png}
%   \includegraphics[width=0.45\linewidth]{Arginine_const_coeff_time.png}
\caption{Iteration count for arginine with a constant permittivity (left: Preconditioned systems, right: No preconditioner). %(1) fix title, (2) can we put them in a single plot, (3) hybrid is internal or external iterations? maybe we should present the total count?
}
\label{fig:arg_contant_iter}
\end{figure}



\section*{\sffamily \Large Results with variable permittivity}

In contrast to a purely BEM approach, FEM-BEM coupling gives flexibility to consider space-varying field parameters. 
A popular description of the molecule is to consider a permittivity that varies like a Gaussian around each atom [earlier papers], which has shown enhanced accuracy in some applications, like binding energy calculations (check) [Alexov].
In this setting, we define a density function $\rho$ depending on position $r$ as
%
\begin{equation}
\rho(r) := \prod_i \left(1 - \exp{\left(\frac{\|r-\mathbf{x}_i\|}{\sigma^2 R_i^2}\right)}\right)
\end{equation}
%
where the product is over the atoms of the solute, $R_i$ is the vdW
radius of atom i and we used $\sigma$=1. Then, we can compute the permittivity as
%
\begin{equation}
\epsilon := \left(1-\rho \right) \epsilon_1 + \rho\epsilon_2
\end{equation}
%

We used Equation \eqref{eq:epsilon_gauss} to generate dielectric maps, which we ran on APBS~\cite{BakerETal2001} for comparison. 
We chose APBS because it provides an easy interface to control dielectric maps, in order to make sure that they agree with the ones imposed in our FEM-BEM coupled approach.
As $\epsilon_2$ is variable, Equation \eqref{eq:phi_coulomb} does not have an analytical solution, and the electrostatic potential in vacuum state has to be computed numerically (MOVE TO METHODS).
For vacuum calculations, we considered the same distribution of $\epsilon$ inside the molecule as in the solvated case, however, the solvent permittivity was set to $\epsilon$=2. 
Other implementations of Gaussian permittivities also modify the solute permittivity in vacuum calculations, according to a set cutoff [Alexov]. 
We did not consider a cutoff in our calculations, but this does not affect our validation exercise. 

\subsection*{\sffamily \large Convergence and performance for arginine}

Table \ref{table:arg_variable} shows a comparison of solvation energy computed with APBS and our FEM-BEM coupling approaches. We can see that they are both converging to equivalent values, where the finest meshes agree up to the third significant figure.

Figure \ref{fig:arg_variable} contains performance results of this test case, where we distinguish the iteration count from the calculation in dissolved and vacuum states. 
Similar to the case with constant permittivity, although the hybrid approach requires less iterations (are we counting them appropriately? meaning there are external and internal iterations), the total time to solution is less for the standard approach. This means that each iteration of hybrid FEM-BEM is slower than the standard counterpart.


\begin{table}
\centering
\begin{tabular}{c|c|c}
&Mesh size & $\Delta G_{solv}$\\
&\AA       &  kcal/mol \\
\hline
\multirow{4}{*}{APBS}& 0.52$\times$0.52$\times$0.52 & -32.4652\\ 
& 0.39$\times$0.39$\times$0.39 & -32.4042\\ 
&0.26$\times$0.26$\times$0.26 & -32.3375\\ 
&0.17$\times$0.17$\times$0.17 & -32.3413\\ 
\hline
&Mesh dens. & \\
&vert/\AA$^2$ & \\
\hline
%\multirow{5}{*}{Standard FEM-BEM}& 2 & -36.239\\
    & 2 & -36.239\\
Standard    & 4  & -33.129 \\
FEM-BEM    & 8  & -32.673 \\
    & 16 & -32.293 \\
\hline
%\multirow{5}{*}{Standard FEM-BEM}& 2 & -29.554\\
    & 2 & -34.408\\
Hybrid    & 4  & -32.815 \\
FEM-BEM    & 8  & -32.566 \\
    & 16 & -32.379 \\
\hline
\end{tabular}
\caption{Solvation energy of arginine with a Gaussian-like permittivity, computed using the standard and hybrid FEM-BEM approaches, and APBS. Add performance result?}
\label{table:arg_variable}
\end{table}

\begin{figure}
\centering
\includegraphics[width=0.45\linewidth]{Arginine_varying_coeff_iter.png}
\includegraphics[width=0.45\linewidth]{Arginine_varying_coeff_time.png}
% \includegraphics[width=0.45\linewidth]{Hybrid_FEM_BEM_Arginine_varying_coeff_iter.png}
% \includegraphics[width=0.45\linewidth]{Hybrid_FEM_BEM_Arginine_varying_coeff_time.png}
\caption{Time-to-solution and iteration count to compute the solvation energy of arginine with a variable permittivity, using standard and hybrid FEM-BEM coupling. %Can we make this only two plots?
}
\label{fig:arg_variable}
\end{figure}


\subsection*{\sffamily \large Performance analysis for larger structures}

So far, in all the small structures that we have tested, the standard approach has been more efficient than the hybrid one.
However, the fact that there are better preconditioning strategies for the hybrid approach indicates that it may become faster for larger test cases, where conditioning of the linear system is usually more important. 
In this section, we compare both approaches for larger structures.
