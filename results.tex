This section presents the verification and performance results of the presented FEM-BEM coupling schemes, for molecules modeled as cavities with constant and varying permittivity.
With a constant permittivity inside the molecule, we tested convergence against an analytical expression of the solvation energy of a sphere \cite{Kirkwood1934}, and then compared a more realistic geometry (arginine) with a purely BEM implementation.
We also considered a Gaussian-varying permittivity\cite{grant2001smooth,li2013dielectric} inside the molecular cavity of arginine, and used APBS \cite{BakerETal2001} to verify our results.
The final tests show the scaling of the FEM-BEM coupling, as the molecule size grows. 

All runs were done on XX computer with YY specifications. 

\section*{\sffamily \Large Software environment}

For the finite element computations, we use the software package FEniCSx while for the boundary element computations we use Bempp-cl together with Exafmm-t. FEniCSx is the successor of the widely used FEniCS finite element library.
It provides a convenient Python interface, in which problems are described using UFL (Unified Form Language), a convenient domain-specific language specifically designed for finite element discretisations of partial differential equations. During assembly the UFL description is transformed into efficient low-level C++ code and just-in-time compiled. Bempp-cl is a Python package that uses low-level OpenCL kernels written in C99 to provide optimised assembly routines. The built-in dense assembly routines are highly efficient for moderate discretisation sizes up to a few ten thousand elements.

For very large grid sizes the user can enable FMM assembly which internally is handled in Bempp-cl through an interface to the Exafmm-t FMM library. For $N$ surface elements this reduces the memory and computational complexity from $\mathcal{O}(N^2)$ in the dense assembly case to $\mathcal{O}(N)$ in the FMM case, making large boundary element problems tractable on standard workstations.

To couple FEniCSx with Bempp-cl we load a volume mesh with FEniCSx. We then export the corresponding boundary mesh into Bempp-cl and assemble the boundary spaces there. Bempp-cl provides numerical trace operators that can translate from the degree of freedom (dof) representation in FEniCSx to the dof representation in Bempp-cl. The corresponding translation work is handled opaquely and the user only needs to deal with high-level interfaces of FEniCSx operators, Bempp-cl operators, and trace operators. FMM assembly fits automatically into this framework and can be enabled or disabled as simple configuration option.

Docker images containing FEniCSx, Bempp-cl, and Exafmm-t are publicly available (PROVIDE LINK), and all codes used in this sections are simple Jupyter Notebooks that can be reproducibly executed in this provided Docker image.

\section*{\sffamily \Large BEM-BEM coupling}

Several possible boundary integral formulations of Equation \eqref{eq:pbe} exist.~\cite{search2022towards} The simplest form was presented by Yoon Âºand Lenhoff in 1991,~\cite{YoonLenhoff1990} known as the \emph{direct} formulation, however, the resulting system is usually ill-conditioned. Here, we use the better conditioned formulation presented by Lu and co-workers,~\cite{LuETal2006,LuETal2009,debuhr2016dashmm} which reads
%
\begin{align}\label{eq:lu}
    & \tfrac{\phi_2}{2}\left(1+\tfrac{\epsilon_1}{\epsilon_2}\right) - \left(K_Y^\Gamma - \tfrac{\epsilon_1}{\epsilon_2}K_L^\Gamma\right)\phi_2 + \left(V_Y^\Gamma - V_L^\Gamma\right)\lambda_2 = \sum_{k=0}^{N_q}  \frac{q_k}{4\pi\epsilon_2|\mathbf{x}_{\Gamma} - \mathbf{x}_k|}
     \nonumber \\
    &\tfrac{\epsilon_1}{\epsilon_2}\left(W_Y^\Gamma - W_L^\Gamma\right)\phi_2 +  \tfrac{\lambda_2}{2}\left(1+\tfrac{\epsilon_1}{\epsilon_2}\right) + \left(\tfrac{\epsilon_1}{\epsilon_2}K_Y^{\prime\Gamma} - K_L^{\prime\Gamma}\right)\lambda_2 = \sum_{k=0}^{N_q}  \frac{\partial}{\partial\mathbf{n}_\mathbf{x}}\left(\frac{q_k}{4\pi\epsilon_2|\mathbf{x}_{\Gamma} - \mathbf{x}_k|}\right)
\end{align}
%
In Equation \eqref{eq:lu}, $\phi_1 = \phi_1(\mathbf{x}_\Gamma)$ and $\phi_2 = \phi_2(\mathbf{x}_\Gamma)$ are the potentials on $\Gamma$ as we approach from $\Omega_1$ and $\Omega_2$, respectively. For convenience, we call the normal derivative on the interface ({\it ie.} the Neumann trace) $\lambda=\left(\frac{\partial}{\partial \mathbf{n}}  \phi_{\Gamma}  \right)$. $V$, $K$, $K^{\prime}$, and $W$ are the single-layer, double-layer, adjoint double-layer, and hypersingular operators for the Laplace (subscript $L$) and Yukawa (subscript $Y$, also known as modified Helmholtz) kernels. These are defined in Equation~\eqref{eq:single_double} and as
%
\begin{align}\label{eq:adj_double_hypersingular}
%V_i^\Gamma \varphi (\mathbf{x}) &= \oint_\Gamma g_i(\mathbf{x},\mathbf{x}')\varphi(\mathbf{x}')d\mathbf{x}'\nonumber\\
%K_i^\Gamma \varphi (\mathbf{x}) &= \oint_\Gamma \frac{\partial g_i}{\partial\mathbf{n}'}(\mathbf{x},\mathbf{x}')\varphi(\mathbf{x}')d\mathbf{x}',\nonumber\\
K^{\prime\Gamma}_i\varphi (\mathbf{x}) &= \oint_\Gamma \frac{g_i}{\partial\mathbf{n}}(\mathbf{x}_\Gamma,\mathbf{x}')\varphi(\mathbf{x}')d\mathbf{x}'\nonumber\\
W^\Gamma_i\varphi (\mathbf{x}) &= - \oint_\Gamma \frac{\partial^2 g_i}{\partial\mathbf{n}'\partial\mathbf{n}}(\mathbf{x}_\Gamma,\mathbf{x}')\varphi(\mathbf{x}')d\mathbf{x}'
\end{align}
%
where $i \in \{L,Y\}$, $\varphi(\mathbf{x})$ can be any distribution over $\Gamma$, and Green's functions $g_L, g_Y$ were defined in Equation~\eqref{eq:green_func}.
%
%\begin{align}\label{eq:green_func}
%g_L(\mathbf{x},\mathbf{x}')=\frac{1}{4\pi|\mathbf{x}-\mathbf{x}'|} \nonumber \\
%g_Y(\mathbf{x},\mathbf{x}')=\frac{e^{-\kappa|\mathbf{x}-\mathbf{x}'|}}{4\pi|\mathbf{x}-\mathbf{x}'|}
%\end{align}
%
%are the corresponding free-space Green's functions.

%%Applying Green's second identity to Equation \eqref{eq:pbe} we get 
%%
%%\begin{align} \label{eq:volume_potential}
%%\phi_{1}(\mathbf{x}_{\Omega_1})+ K_{L}^{\Omega_1}\phi_1 -  V_{L}^{\Omega_1} \lambda_2^1 & = \tfrac{1}{\epsilon_1} \sum_{k=0}^{N_q}  \frac{q_k}{4\pi|\mathbf{x}_{\Omega_1} - \mathbf{x}_k|}  \quad \text{on $\Omega_1$,} \nonumber \\
%%\phi_{2}(\mathbf{x}_{\Omega_2}) - K_{Y}^{\Omega_2}\phi_2 + \tfrac{\epsilon_1}{\epsilon_2} V_{Y}^{\Omega_2} \lambda_2& = 0 \quad \text{on $\Omega_2$,}
%%\end{align}
%%
%%where $\mathbf{x}_\Omega$ is evaluated anywhere in the correspoding domain, except $\Gamma$, and $\phi_1 = \phi_1(\mathbf{x}_\Gamma)$ and $\phi_2 = \phi_2(\mathbf{x}_\Gamma)$ are the potentials on $\Gamma$ as we approach from $\Omega_1$ and $\Omega_2$, respectively. For convenience, we call the normal derivative on the interface ({\it ie.} the Neumann trace) $\lambda=\left(\frac{\partial}{\partial \mathbf{n}}  \phi_{\Gamma}  \right)$. $K$ and $V$ are the double- and single-layer potentials for the Laplace (subscript $L$) and Yukawa (subscript $Y$, also known as modified Helmholtz) kernels
%%
%%\begin{align}\label{eq:single_double}
%%V^D \varphi (\mathbf{x}) = \oint_\Gamma g_i(\mathbf{x},\mathbf{x}')\varphi(\mathbf{x}')d\mathbf{x}'\nonumber\\
%%K^D \varphi (\mathbf{x}) = \oint_\Gamma \frac{\partial g_i}{\partial\mathbf{n}'}(\mathbf{x},\mathbf{x}')\varphi(\mathbf{x}')d\mathbf{x}',\nonumber\\
%%\end{align}
%%
%%where $D \in \{\Omega_1, \Omega_2, \Gamma\}$, $i \in \{L,Y\}$, $\varphi(\mathbf{x})$ can be any distribution over $\Gamma$, and 
%%
%%\begin{align}\label{eq:green_func}
%%g_L(\mathbf{x},\mathbf{x}')=\frac{1}{4\pi|\mathbf{x}-\mathbf{x}'|} \nonumber \\
%%g_Y(\mathbf{x},\mathbf{x}')=\frac{e^{-\kappa|\mathbf{x}-\mathbf{x}'|}}{4\pi|\mathbf{x}-\mathbf{x}'|}
%%\end{align}
%%
%%are the free-space Green's function of the Laplace and linearized Poisson-Boltzmann equations, respectively. 
%
%%If we take the limit of Eq. \eqref{eq:volume_potential} as $\mathbf{x}_{\Omega}$ approaches $\Gamma$, we get
%%
%%\begin{align} \label{eq:direct}
%%\tfrac{\phi_1}{2}+ K_{L}^{\Gamma}\phi_1 -  V_{L}^{\Gamma} \lambda_2^1 & = \tfrac{1}{\epsilon_1} \sum_{k=0}^{N_q}  \frac{q_k}{4\pi|\mathbf{x}_{\Gamma} - \mathbf{x}_k|} \nonumber \\
%%\tfrac{\phi_2}{2} - K_{Y}^{\Gamma}\phi_2 +  \tfrac{\epsilon_1}{\epsilon_2} V_{Y}^{\Gamma} \lambda_2 & = 0
%%\end{align}
%%
%%The {\it direct} formulation\cite{YoonLenhoff1990} couples the two expressions of Eq. \eqref{eq:direct} on $\Gamma$, considering the interface conditions. Even though this formulation is poorly conditioned with respect to the mesh size, it can still model large systems when it is preconditioned appropriately.\cite{AltmanBardhanWhiteTidor09,MartinezETal2019,wang2021high} 
%%The formulation presented by Lu\cite{LuETal2006} takes the normal derivative of \eqref{eq:direct} to couple both $\phi$ and $\partial\phi/\partial\mathbf{n}$ as
%%
%%\begin{align}\label{eq:lu}
%%    & \tfrac{\phi_2}{2}\left(1+\tfrac{\epsilon_1}{\epsilon_2}\right) - \left(K_Y^\Gamma - \tfrac{\epsilon_1}{\epsilon_2}K_L^\Gamma\right)\phi_2 + \left(V_Y^\Gamma - V_L^\Gamma\right)\lambda_2 = \sum_{k=0}^{N_q}  \frac{q_k}{4\pi\epsilon_2|\mathbf{x}_{\Gamma} - \mathbf{x}_k|}
%%     \nonumber \\
%%    &\tfrac{\epsilon_1}{\epsilon_2}\left(W_Y^\Gamma - W_L^\Gamma\right)\phi_2 +  \tfrac{\lambda_2}{2}\left(1+\tfrac{\epsilon_1}{\epsilon_2}\right) + \left(\tfrac{\epsilon_1}{\epsilon_2}K_Y^{\prime\Gamma} - K_L^{\prime\Gamma}\right)\lambda_2 = \sum_{k=0}^{N_q}  \frac{\partial}{\partial\mathbf{n}_\mathbf{x}}\left(\frac{q_k}{4\pi\epsilon_2|\mathbf{x}_{\Gamma} - \mathbf{x}_k|}\right)
%%\end{align}
%%
%%The two new integral operators that appear are defined as 
%%
%%\begin{align}
%%\label{eq:adj_hyp}
%%K^{\prime\Gamma}_i\varphi (\mathbf{x}) = \oint_\Gamma \frac{g_i}{\partial\mathbf{n}}(\mathbf{x}_\Gamma,\mathbf{x}')\varphi(\mathbf{x}')d\mathbf{x}'\nonumber\\
%%W^\Gamma_i\varphi (\mathbf{x}) = - \oint_\Gamma \frac{\partial^2 g_i}{\partial\mathbf{n}'\partial\mathbf{n}}(\mathbf{x}_\Gamma,\mathbf{x}')\varphi(\mathbf{x}')d\mathbf{x}'
%%\end{align}
%%where $i \in \{L,Y\}$, 
%%and are called the {\it  adjoint double layer} and {\it hypersingular} operators, respectively. Note that the potential in Eq. \eqref{eq:lu} is evaluated on the exterior. 
%
%In weak form, Eq. \eqref{eq:lu} becomes
%%
%\begin{align}\label{eq:lu_disc}
%&\left< \left(1+\tfrac{\epsilon_1}{\epsilon_2}\right) \tfrac{\phi_{2}}{2} - \left(K_Y^\Gamma - \tfrac{\epsilon_1}{\epsilon_2}K_L^\Gamma\right)\phi_{2}, v \right>_{\Gamma} + \left< \left(V_Y^\Gamma - V_L^\Gamma\right) \lambda_2, v \right>_\Gamma = \left< \sum_{k=0}^{N_q}  f_k, v \right>_{\Gamma} \nonumber \\
%&\left< \tfrac{\epsilon_1}{\epsilon_2}\left(W_Y^\Gamma - W_L^\Gamma\right)\phi_{2}, \zeta \right>_\Gamma + \left<  \left(1+\tfrac{\epsilon_1}{\epsilon_2}\right) \tfrac{\lambda_2}{2} + \left(\tfrac{\epsilon_1}{\epsilon_2}K_Y^{\prime\Gamma} - K_L^{\prime\Gamma}\right)\lambda_2, \zeta\right>_\Gamma = \left< \sum_{k=0}^{N_q}  \frac{\partial}{\partial\mathbf{n}_\mathbf{x}} f_k, \zeta \right>_{\Gamma}
%\end{align}
%%
%where $v, \zeta$ are test functions, $\left<\varphi,v\right>_\Gamma = \int_\Gamma \varphi(\mathbf{x})v(\mathbf{x})d\mathbf{x}$ %and $\left(\varphi,v\right)_\Omega = \int_\Omega \varphi(\mathbf{x})v(\mathbf{x})d\mathbf{x}$ are 
%is the inner products on the surface% and domain, respectively
%and $f_k := \frac{q_k}{4\pi\epsilon_2|\mathbf{x}_{\Gamma} - \mathbf{x}_k|}$.
%
%We introduce below the matrix formulation. Let $\vec{\phi}_2 := [\phi_2^1, \dots, \phi_2^k]^T$ be the vector of canonical basis
%functions of $W_{h}^{k}$ and  $\vec{\lambda}_2 := [\lambda_2^1, \dots, \lambda_2^l]^T$ - the vector of canonical basis
%functions of $\Lambda_{h}^{l}$. We define the following matrices associated with the corresponding bilinear forms
%\begin{align*}
%\widetilde{K}_{\alpha \beta} = \left<\left(K_Y^\Gamma - \tfrac{\epsilon_1}{\epsilon_2}K_L^\Gamma\right) \phi^{\alpha}_2, \ \lambda^{\beta}_2 \right>_{\Gamma}
% &,&
%\widetilde{V}_{\alpha \beta} = \left<\left(V_Y^\Gamma - V_L^\Gamma\right) \lambda^{\alpha}_2, \ \lambda^{\beta}_2 \right>_{\Gamma}, \\
%\widetilde{W}_{\alpha \beta} = \left<\left(W_Y^\Gamma - W_L^\Gamma\right) \phi^{\alpha}_2, \ \phi^{\beta}_2 \right>_{\Gamma}
% &,&
%\widetilde{K'}_{\alpha \beta} = \left<\left(\tfrac{\epsilon_1}{\epsilon_2}K_Y^{\prime\Gamma} - K_L^{\prime\Gamma}\right) \lambda^{\alpha}_2, \ \phi^{\beta}_2 \right>_{\Gamma},
%\end{align*}
%and vectors associated with the corresponding linear forms
%\begin{align*}
%\vec{f}_{\beta} = \left< \sum_{k=0}^{N_q}  \frac{q_k}{4\pi\epsilon_2|\mathbf{x}_{\Gamma} - \mathbf{x}_k|},   \phi^{\beta}_1  \right>_{\Gamma} &,& \vec{\partial f}_{\beta} = \left< \sum_{k=0}^{N_q}  \frac{\partial}{\partial\mathbf{n}_\mathbf{x}}\left(\frac{q_k}{4\pi\epsilon_2|\mathbf{x}_{\Gamma} - \mathbf{x}_k|}\right),   \phi^{\beta}_1  \right>_{\Gamma}.
%\end{align*}
%
%Using the above definition the discrete problem~\eqref{eq:fem_bem_disctrete} can be written in the following matrix form
%\begin{align*}
%\begin{bmatrix}
% \tfrac12 \left(1+\tfrac{\epsilon_1}{\epsilon_2}\right) I - \widetilde{K}  & \widetilde{V}  \\  
% \tfrac{\epsilon_1}{\epsilon_2} \widetilde{W} & \tfrac12 \left(1+\tfrac{\epsilon_1}{\epsilon_2}\right) I + \widetilde{K'}
%\end{bmatrix}
%\begin{bmatrix}
%\vec{\phi}_2 \\
%\vec{\lambda}_2 
%\end{bmatrix}
%= 
%\begin{bmatrix}
%\vec{f} \\  
%\vec{\partial f}
%\end{bmatrix}.
%\end{align*}
%%
%

\section*{\sffamily \Large Results with constant permitivitty}

In implicit-solvent models, the molecule is usually considered as a region with constant permittivity, in this case, with $\epsilon_1=4$.
In the solvent region, we used the permittivity of water ($\epsilon_2$=80) and an inverse of the Debye length of $\kappa=0.125$ \AA$^{-1}$.
As in these cases there is an analytical solution for $\phi_c$ in Eq. \eqref{eq:phic}, we compute $\phi_r$ with Eq. \eqref{eq:phi_reac} in both BEM-BEM and FEM-BEM coupling approaches. Then, for FEM-BEM, the integral over $\Gamma$ in Eq. \eqref{eq:phi_reac} corresponds to the trace of the solution vector.

\subsection*{\sffamily \large Convergence of a spherical cavity}

The Kirkwood sphere \cite{Kirkwood1934} is a standard benchmark test for the Poisson-Boltzmann equation in molecular electrostatics. 
In this case, we considered a spherical cavity of radius $R=2$ \AA, with three charges ($q_1$=1, $q_2$=1, and $q_3$=0.75) placed at $\mathbf{x}_1=(1,0,0)$, $\mathbf{x}_2=(0.7,0.7,0)$, and $\mathbf{x}_3=(-0.5,-0.5,0)$.
Figure \ref{fig:error_sphere} shows the error convergence of the FEM-BEM approaches, and a reference BEM implementation, to the analytical solution ($\Delta G_{solv}= -164.3375$ kcal/mol). 
In these runs, the FEM mesh was generated using GMSH~\cite{geuzaine2009gmsh}. 
%Bempp (check?) from a surface discretization 
with 1, 2, 4, and 8 vertices per \AA$^2$ on the SES, the surface mesh of this volume one was also used for the BEM runs. 
%For the hybrid FEM-BEM coupling approach, we used $\tau$=5.
The error in Figure \ref{fig:error_sphere} decays linearly with the surface area, which agrees with the expected convergence for P1 elements, indicating a correct implementation of the numerical scheme. 
%We can see that the purely BEM implementation outperforms (or not?) FEM-BEM coupling in terms of accuracy for equivalent meshes, and also that the hybrid approach does not (or does?) influence accuracy. 

\begin{figure}
  \centering
  \includegraphics[width=0.6\linewidth]{Sphere_const_coeff_error.png}
%   \includegraphics[width=0.45\linewidth]{Sphere_const_coeff_iter.png}
%   \includegraphics[width=0.45\linewidth]{Sphere_const_coeff_time.png}
  \caption{Error for the Kirkwood sphere.}
  \label{fig:error_sphere}
\end{figure}

\subsection*{\sffamily \large Performance with arginine}

As a more realistic test, we assessed the performance of the FEM-BEM coupling technique against a purely BEM implementation for arginine (the structure of arginine taken from the protein data bank \cite{bank}). 
We generated surface meshes containing W, X, Y, and Z vertices per \AA$^2$ with Nanoshaper.~\cite{decherchi2013general}
These meshes were inputs to our purely BEM solver, and to create the FEM mesh with pyGAMer,~\cite{lee2020open} which invoked \texttt{tetgen} [citation] with the string \texttt{abcd}.

The solvation energy computed with the two schemes is presented by Figure \ref{fig:arg_constant_energy}, which, as expected, converges to a similar answer as the mesh is refined.
Then, Figure \ref{fig:arg_constant_time_iter} compares the iteration count and time-to-solution. The left plot shows that using only BEM outperforms the coupled FEM-BEM approach in terms of iterations count. However, if we look at the total time that solvers take to obtain the solution, we can see the advantage of using the FEM-BEM coupling. The higher computational cost is caused by the need of using a hypersingular operator in the BEM formulation.


\begin{figure}
\centering
   \includegraphics[width=0.6\linewidth]{Arginine_const_coeff_error_11.png}
%    \includegraphics[width=0.45\linewidth]{No_prec_Arginine_const_coeff_error.png}
\caption{Solvation energy for arginine with a constant permittivity.
%maybe we could also add a "error" wrt extrapolation, or a plot with energy for each mesh?
}
\label{fig:arg_constant_energy}
\end{figure}

\begin{figure}
\centering
   \includegraphics[width=0.45\linewidth]{Arginine_const_coeff_iter_11.png}
%  \includegraphics[width=0.45\linewidth]{Arginine_const_coeff_time_11.png}
%  \includegraphics[width=0.45\linewidth]{Arginine_const_coeff_setup_time_11.png}
  \includegraphics[width=0.45\linewidth]{Arginine_const_coeff_total_time_11.png}
  \caption{Iteration count (left) and time-to-solution (right) for arginine with a constant permittivity. %(left: Online time taken to solve systems, right: Offline time taken to set up systems). 
%NOTE: x axis differ between top and bottom. Also, should we include preconditioned vs non preconditioned? We could easily precondition BEM-BEM too.  %(1) fix title, (2) can we put them in a single plot, (3) 
%maybe we could also add a "error" wrt extrapolation, or a plot with energy for each mesh?
}
\label{fig:arg_constant_time_iter}
\end{figure}


%\begin{figure}
%\centering
%%   \includegraphics[width=0.45\linewidth]{Arginine_const_coeff_error.png}
%  \includegraphics[width=0.45\linewidth]{Arginine_const_coeff_iter_11.png}
%%   \includegraphics[width=0.45\linewidth]{No_prec_Arginine_const_coeff_iter.png}
%%   \includegraphics[width=0.45\linewidth]{Arginine_const_coeff_time.png}
%\caption{Iteration count for arginine with a constant permittivity. %(1) fix title, (2) can we put them in a single plot, (3) hybrid is internal or external iterations? maybe we should present the total count?
%}
%\label{fig:arg_contant_iter}
%\end{figure}



\section*{\sffamily \Large Results with variable permittivity}

\subsection*{\sffamily \large Motivation: modeling the solute with a Gaussian-based variable permittivity}

In contrast to a purely BEM approach, FEM-BEM coupling gives flexibility to consider space-varying field parameters. 
A popular description of the molecule is to consider a permittivity that varies like a Gaussian around each atom,\cite{grant2001smooth} which has shown enhanced accuracy in some applications, like pKa calculations.\cite{li2013dielectric}
In this setting, we define a density function $\rho$ depending on position $r$ as
%
\begin{equation}
\rho(r) := \prod_i \left(1 - \exp{\left(\frac{\|r-\mathbf{x}_i\|}{\sigma^2 R_i^2}\right)}\right)
\end{equation}
%
where the product runs over all the atoms of the solute, $R_i$ is the van der Waals radius of atom i, and we used $\sigma$=1. Then, we can compute the permittivity as
%
\begin{equation}\label{eq:varying_eps}
\epsilon := \left(1-\rho \right) \epsilon_1 + \rho\epsilon_2
\end{equation}

As $\epsilon_2$ is variable, Equation \eqref{eq:phic} does not have an analytical solution, and the electrostatic potential in vacuum state has to be computed numerically.
For vacuum calculations, we considered the same distribution of $\epsilon_2$ inside the molecule as in the solvated case, but the solvent permittivity was set to $\epsilon$=2. 
Other implementations of Gaussian permittivities also modify the solute permittivity in vacuum calculations, according to a set cutoff.\cite{li2013dielectric} We did not consider a cutoff in our calculations.


We used Equation \eqref{eq:varying_eps} to generate dielectric maps, which we ran on APBS~\cite{BakerETal2001} for comparison. 
We chose APBS because it provides an easy interface to control dielectric maps, in order to ensure their agreement with the maps imposed in our FEM-BEM coupled approach.

\subsection*{\sffamily \large Convergence and performance for arginine}

Table \ref{table:arg_variable} shows a comparison of solvation energy computed with APBS and our FEM-BEM coupling approach. We can see that they are both converging to equivalent values, where the finest meshes agree up to 1.5\% (0.5 kcal/mol).

Figure \ref{fig:arg_variable} contains performance results of this test case, where we distinguish the iteration count from the calculation in dissolved and vacuum states. 

\begin{table}
\centering
\begin{tabular}{c|c|c}
&Mesh size & $\Delta G_{solv}$\\
&\AA       &  kcal/mol \\
\hline
\multirow{4}{*}{APBS}& 0.52$\times$0.52$\times$0.52 & -32.4652\\ 
& 0.39$\times$0.39$\times$0.39 & -32.4042\\ 
&0.26$\times$0.26$\times$0.26 & -32.3375\\ 
&0.17$\times$0.17$\times$0.17 & -32.3413\\ 
\hline
&Mesh dens. & \\
&vert/\AA$^2$ & \\
\hline
%\multirow{5}{*}{Standard FEM-BEM}& 2 & -36.239\\
    & 2 & -35.688 \\
FEM-BEM    & 4  & -33.304 \\
coupling    & 8  & -32.634 \\
    & 16 & -31.868 \\
\hline
%\multirow{5}{*}{Standard FEM-BEM}& 2 & -29.554\\
%    & 2 & -34.670\\
%Hybrid    & 4  & -33.603 \\
%FEM-BEM    & 8  & -32.822 \\
%    & 16 & -32.072 \\
%\hline
\end{tabular}
\caption{Solvation energy of arginine with a Gaussian-like permittivity, computed using the FEM-BEM approach and APBS. The mesh density for FEM-BEM corresponds to the vertex density of the surface mesh used to generate the volumetric mesh. Add performance result?}
\label{table:arg_variable}
\end{table}

\begin{figure}
\centering
% \includegraphics[width=0.45\linewidth]{Arginine_varying_coeff_iter.png}
% \includegraphics[width=0.45\linewidth]{Arginine_varying_coeff_time.png}
\includegraphics[width=0.45\linewidth]{Arginine_varying_coeff_time_11.png}
\includegraphics[width=0.45\linewidth]{Arginine_varying_coeff_setup_time_11.png}
\includegraphics[width=0.45\linewidth]{Arginine_varying_coeff_iter_11.png}
\caption{Iteration count and time-to-solution to compute the solvation energy of arginine with a variable permittivity (left: Online time taken to solve systems, right: Offline time taken to set up systems), using FEM-BEM coupling. %Can we make this only two plots?
}
\label{fig:arg_variable}
\end{figure}


\subsection*{\sffamily \large Performance analysis for larger structures}

So far, we have only tested the FEM-BEM coupled approach with small structures. Here, we study its behavior with larger structures to evaluate its applicability in more realistic settings.
